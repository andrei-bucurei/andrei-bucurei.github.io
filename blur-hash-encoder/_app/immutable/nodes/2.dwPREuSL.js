import{a as F,t as z,d as Ve,e as Fe}from"../chunks/disclose-version.Cax0eFe8.js";import{D as We,l as Ye,j as O,m as le,k as Je,J as Pe,i as ze,Q as Ae,H as Ge,r as _e,n as ie,u as ee,M as Ke,p as He,q as Te,t as Qe,a6 as me,e as ge,c as re,a7 as Xe,a8 as Ze,a1 as je,s as pe,a9 as ke,aa as ea,P as Le,ab as aa,w as ta,I as ra,ac as sa,ad as na,h as we,ae as oa,af as la,ag as ia,x as ca,a2 as ae,z as ua,d as H,ah as ce,ai as va,a5 as y,y as be,a3 as L,a4 as A,aj as xe,ak as K,v as da}from"../chunks/runtime.D_JB_B6u.js";import{d as ha,h as fa,s as se,e as _a,r as ma}from"../chunks/render.CJsXyEpM.js";import{p as Me,i as te}from"../chunks/if.1ZWYAElj.js";let ue=null;function ga(e,a){return a}function pa(e,a,s,c){for(var i=[],w=a.length,p=0;p<w;p++)ea(a[p].e,i,!0);var T=w>0&&i.length===0&&s!==null;if(T){var S=s.parentNode;Le(S),S.append(s),c.clear(),W(e,a[0].prev,a[w-1].next)}aa(i,()=>{for(var h=0;h<w;h++){var x=a[h];T||(c.delete(x.k),W(e,x.prev,x.next)),ta(x.e,!T)}})}function wa(e,a,s,c,i,w=null){var p=e,T={flags:a,items:new Map,first:null};{var S=e;p=O?le(Pe(S)):S.appendChild(We())}O&&Je();var h=null;Ye(()=>{var x=s(),t=ze(x)?x:x==null?[]:Ae(x),r=t.length;let n=!1;if(O){var o=p.data===Ge;o!==(r===0)&&(p=_e(),le(p),ie(!1),n=!0)}if(O){for(var v=null,u,m=0;m<r;m++){if(ee.nodeType===8&&ee.data===Ke){p=ee,n=!0,ie(!1);break}var q=t[m],b=c(q,m);u=Ne(ee,T,v,null,q,b,m,i,a),T.items.set(b,u),v=u}r>0&&le(_e())}O||ba(t,T,p,i,a,c),w!==null&&(r===0?h?He(h):h=Te(()=>w(p)):h!==null&&Qe(h,()=>{h=null})),n&&ie(!0)}),O&&(p=ee)}function ba(e,a,s,c,i,w){var p=e.length,T=a.items,S=a.first,h=S,x,t=null,r=[],n=[],o,v,u,m;for(m=0;m<p;m+=1){if(o=e[m],v=w(o,m),u=T.get(v),u===void 0){var q=h?h.e.nodes_start:s;t=Ne(q,a,t,t===null?a.first:t.next,o,v,m,c,i),T.set(v,t),r=[],n=[],h=t.next;continue}if(xa(u,o,m),u.e.f&me&&He(u.e),u!==h){if(x!==void 0&&x.has(u)){if(r.length<n.length){var b=n[0],_;t=b.prev;var g=r[0],f=r[r.length-1];for(_=0;_<r.length;_+=1)ye(r[_],b,s);for(_=0;_<n.length;_+=1)x.delete(n[_]);W(a,g.prev,f.next),W(a,t,g),W(a,f,b),h=b,t=f,m-=1,r=[],n=[]}else x.delete(u),ye(u,h,s),W(a,u.prev,u.next),W(a,u,t===null?a.first:t.next),W(a,t,u),t=u;continue}for(r=[],n=[];h!==null&&h.k!==v;)h.e.f&me||(x??(x=new Set)).add(h),n.push(h),h=h.next;if(h===null)continue;u=h}r.push(u),t=u,h=u.next}if(h!==null||x!==void 0){for(var l=x===void 0?[]:Ae(x);h!==null;)l.push(h),h=h.next;var d=l.length;if(d>0){var M=p===0?s:null;pa(a,l,M,T)}}ge.first=a.first&&a.first.e,ge.last=t&&t.e}function xa(e,a,s,c){re(e.v,a),e.i=s}function Ne(e,a,s,c,i,w,p,T,S){var h=ue;try{var x=(S&Xe)!==0,t=(S&Ze)===0,r=x?t?je(i):pe(i):i,n=S&ke?pe(p):p,o={i:n,v:r,k:w,a:null,e:null,prev:s,next:c};return ue=o,o.e=Te(()=>T(e,r,n),O),o.e.prev=s&&s.e,o.e.next=c&&c.e,s===null?a.first=o:(s.next=o,s.e.next=o.e),c!==null&&(c.prev=o,c.e.prev=o.e),o}finally{ue=h}}function ye(e,a,s){for(var c=e.next?e.next.e.nodes_start:s,i=a?a.e.nodes_start:s,w=e.e.nodes_start;w!==c;){var p=ra(w);i.before(w),w=p}}function W(e,a,s){a===null?e.first=s:(a.next=s,a.e.next=s&&s.e),s!==null&&(s.prev=a,s.e.prev=a&&a.e)}function Ma(e){O&&Pe(e)!==null&&Le(e)}let Ie=!1;function Se(){Ie||(Ie=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var a;if(!e.defaultPrevented)for(const s of e.target.elements)(a=s.__on_r)==null||a.call(s)})},{capture:!0}))}function ve(e){if(O){var a=!1,s=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var c=e.value;Q(e,"value",null),e.value=c}if(e.hasAttribute("checked")){var i=e.checked;Q(e,"checked",null),e.checked=i}}};e.__on_r=s,sa(s),Se()}}function ya(e,a){var s=e.__attributes??(e.__attributes={});s.value!==(s.value=a)&&(e.value=a)}function Q(e,a,s,c){var i=e.__attributes??(e.__attributes={});O&&(i[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||i[a]!==(i[a]=s)&&(a==="loading"&&(e[na]=s),s==null?e.removeAttribute(a):typeof s!="string"&&Ia(e).includes(a)?e[a]=s:e.setAttribute(a,s))}var De=new Map;function Ia(e){var a=De.get(e.nodeName);if(a)return a;De.set(e.nodeName,a=[]);for(var s,c=we(e);c.constructor.name!=="Element";){s=oa(c);for(var i in s)s[i].set&&a.push(i);c=we(c)}return a}function Da(e,a){var s=e.__className,c=Ea(a);O&&e.className===c?e.__className=c:(s!==c||O&&e.className!==c)&&(a==null?e.removeAttribute("class"):e.className=c,e.__className=c)}function Ea(e){return e??""}function Ee(e,a,s){if(s){if(e.classList.contains(a))return;e.classList.add(a)}else{if(!e.classList.contains(a))return;e.classList.remove(a)}}function qa(e,a,s,c=s){e.addEventListener(a,s);const i=e.__on_r;i?e.__on_r=()=>{i(),c()}:e.__on_r=c,Se()}function de(e,a,s=a){var c=la();qa(e,"input",()=>{var i=qe(e)?Ce(e.value):e.value;s(i),c&&i!==(i=a())&&(e.value=i??"")}),ia(()=>{var i=a();if(O&&e.defaultValue!==e.value){s(e.value);return}qe(e)&&i===Ce(e.value)||e.type==="date"&&!i&&!e.value||(e.value=i??"")})}function qe(e){var a=e.type;return a==="number"||a==="range"}function Ce(e){return e===""?null:+e}const he=function(e){const a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],s=t=>{let r=0;for(let n=0;n<t.length;n++){const o=t[n];r=83*r+a.indexOf(o)}return r},c=(t,r)=>{var n="";for(let o=1;o<=r;o++){let v=Math.floor(t)/Math.pow(83,r-o)%83;n+=a[Math.floor(v)]}return n},i=t=>{let r=t/255;return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)},w=t=>{let r=Math.max(0,Math.min(1,t));return r<=.0031308?Math.round(12.92*r*255+.5):Math.round(255*(1.055*Math.pow(r,.4166666666666667)-.055)+.5)},p=(t,r)=>(n=>n<0?-1:1)(t)*Math.pow(Math.abs(t),r),T=t=>{if(!t||t.length<6)throw new Error("The blurhash string must be at least 6 characters");const r=s(t[0]),n=Math.floor(r/9)+1,o=r%9+1;if(t.length!==4+2*o*n)throw new Error(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*o*n}`)},S=t=>{const r=t>>8&255,n=255&t;return[i(t>>16),i(r),i(n)]},h=(t,r)=>{const n=Math.floor(t/361),o=Math.floor(t/19)%19,v=t%19;return[p((n-9)/9,2)*r,p((o-9)/9,2)*r,p((v-9)/9,2)*r]},x=(t,r,n,o)=>{let v=0,u=0,m=0;const q=4*r;for(let _=0;_<r;_++)for(let g=0;g<n;g++){const f=o(_,g);v+=f*i(t[4*_+0+g*q]),u+=f*i(t[4*_+1+g*q]),m+=f*i(t[4*_+2+g*q])}let b=1/(r*n);return[v*b,u*b,m*b]};return e.decodePromise=(t,r,n,o=1)=>new Promise((v,u)=>{v(e.decode(t,r,n,o))}),e.decode=(t,r,n,o=1)=>{T(t),o|=1;const v=s(t[0]),u=Math.floor(v/9)+1,m=v%9+1,q=(s(t[1])+1)/166,b=new Array(m*u);for(let f=0;f<b.length;f++)if(f===0){const l=s(t.substring(2,6));b[f]=S(l)}else{const l=s(t.substring(4+2*f,6+2*f));b[f]=h(l,q*o)}const _=4*r,g=new Uint8ClampedArray(_*n);for(let f=0;f<n;f++)for(let l=0;l<r;l++){let d=0,M=0,I=0;for(let P=0;P<u;P++)for(let E=0;E<m;E++){const B=Math.cos(Math.PI*l*E/r)*Math.cos(Math.PI*f*P/n);let U=b[E+P*m];d+=U[0]*B,M+=U[1]*B,I+=U[2]*B}let C=w(d),D=w(M),R=w(I);g[4*l+0+f*_]=C,g[4*l+1+f*_]=D,g[4*l+2+f*_]=R,g[4*l+3+f*_]=255}return g},e.encodePromise=(t,r,n,o,v)=>new Promise((u,m)=>{u(e.encode(t,r,n,o,v))}),e.encode=(t,r,n,o,v)=>{if(o<1||o>9||v<1||v>9)throw new Error("BlurHash must have between 1 and 9 components");if(r*n*4!==t.length)throw new Error("Width and height must match the pixels array");let u=[];for(let g=0;g<v;g++)for(let f=0;f<o;f++){const l=f==0&&g==0?1:2,d=x(t,r,n,(M,I)=>l*Math.cos(Math.PI*f*M/r)*Math.cos(Math.PI*g*I/n));u.push(d)}const m=u[0],q=u.slice(1);let b,_="";if(_+=c(o-1+9*(v-1),1),q.length>0){let g=Math.max(...q.map(l=>Math.max(...l))),f=Math.floor(Math.max(0,Math.min(82,Math.floor(166*g-.5))));b=(f+1)/166,_+=c(f,1)}else b=1,_+=c(0,1);return _+=c((g=>(w(g[0])<<16)+(w(g[1])<<8)+w(g[2]))(m),4),q.forEach(g=>{_+=c(((f,l)=>19*Math.floor(Math.max(0,Math.min(18,Math.floor(9*p(f[0]/l,.5)+9.5))))*19+19*Math.floor(Math.max(0,Math.min(18,Math.floor(9*p(f[1]/l,.5)+9.5))))+Math.floor(Math.max(0,Math.min(18,Math.floor(9*p(f[2]/l,.5)+9.5)))))(g,b),2)}),_},e.getImageData=t=>{const r=t.width,n=t.height,o=document.createElement("canvas"),v=o.getContext("2d");return o.width=r,o.height=n,v.width=r,v.height=n,v.drawImage(t,0,0),v.getImageData(0,0,r,n).data},e.drawImageDataOnNewCanvas=(t,r,n)=>{const o=document.createElement("canvas"),v=o.getContext("2d");return o.width=r,o.height=n,v.width=r,v.height=n,v.putImageData(new ImageData(t,r,n),0,0),o},e.getImageDataAsImageWithOnloadPromise=(t,r,n)=>new Promise((o,v)=>{e.getImageDataAsImage(t,r,n,(u,m)=>{o(m)})}),e.getImageDataAsImage=(t,r,n,o)=>{const v=e.drawImageDataOnNewCanvas(t,r,n).toDataURL(),u=new Image(r,n);return u.onload=m=>o(m,u),u.width=r,u.height=n,u.src=v,u},e}({});async function Ca(e,a,s){const c=H(a).split(/\r?\n/).filter(i=>i.trim()!=="");await new Promise(i=>setTimeout(i,0)),re(a,""),s(c)}var Pa=Ve('<script src="analytics.js"><\/script><!---->',1),Aa=z('<img alt="BlurHash" class="svelte-4newrq">'),Ha=z('<span class="not-available svelte-4newrq">n/a</span>'),Ta=(e,a,s)=>a(e,s().blurHash),La=z('<input class="blur-hash svelte-4newrq" type="text" title="Copy" readonly=""> <button class="copy-button svelte-4newrq">â§‰</button>',1),Na=z('| <span class="cors-tag svelte-4newrq" title="Used CORS proxy">CORS</span>',1),Sa=z("<span> </span>"),Oa=z('<div class="item svelte-4newrq"><div class="thumbnail image-thumbnail svelte-4newrq"><img alt="Original" class="svelte-4newrq"></div> <div class="spacer svelte-4newrq"></div> <div class="thumbnail blur-hash-thumbnail svelte-4newrq"><!> <!></div> <div class="spacer svelte-4newrq"></div> <div class="info svelte-4newrq"><div class="blur-hash-section svelte-4newrq"><span class="label svelte-4newrq">BlurHash:</span> <!></div> <div class="truncated svelte-4newrq"><span class="label svelte-4newrq">Components:</span> <span> </span></div> <div class="truncated svelte-4newrq"><span class="label svelte-4newrq">URL:</span> <a target="_blank"> </a></div> <div class="truncated svelte-4newrq"><span class="label svelte-4newrq">Status:</span> <span> </span> <!></div> <div class="truncated svelte-4newrq"><span class="label svelte-4newrq">Duration:</span> <!></div></div></div>'),Ra=z('<div id="page-layout" class="svelte-4newrq"><header class="svelte-4newrq"><h1>BlurHash Encoder</h1> <textarea id="input" rows="4" placeholder="Enter image URLs" class="svelte-4newrq"></textarea> <div><button id="encode-button" class="svelte-4newrq">Encode</button> Components: <input class="components-input svelte-4newrq" type="number" min="1" max="10"> âœ• <input class="components-input svelte-4newrq" type="number" min="1" max="10"></div></header> <main class="svelte-4newrq"><noscript></noscript> <div id="items"></div></main> <footer class="svelte-4newrq">Footer</footer></div>');function Fa(e,a){ca(a,!0);const s=(l,d=da)=>{var M=Oa(),I=L(M),C=L(I);A(I);var D=y(I,4),R=L(D);te(R,()=>d().blurHashImageSrc,$=>{var N=Aa();ae(()=>Q(N,"src",d().blurHashImageSrc)),F($,N)});var P=y(R,2);te(P,()=>d().status==="failed",$=>{var N=Ha();F($,N)}),A(D);var E=y(D,4),B=L(E),U=y(L(B),2);te(U,()=>d().blurHash!=="",$=>{var N=La(),k=be(N);ve(k);var oe=y(k,2);oe.__click=[Ta,n,d],ae(()=>ya(k,d().blurHash)),F($,N)},$=>{var N=Fe("n/a");F($,N)}),A(B);var Y=y(B,2),X=y(L(Y),2),ne=L(X);A(X),A(Y);var Z=y(Y,2),j=y(L(Z),2),J=L(j);A(j),A(Z);var V=y(Z,2),G=y(L(V),2),Oe=L(G);A(G);var Re=y(G,2);te(Re,()=>d().usedCorsProxy,$=>{var N=Na();xe(),F($,N)}),A(V);var fe=y(V,2),Be=y(L(fe),2);te(Be,()=>d().endDate,$=>{var N=Sa();const k=K(()=>d().endDate.getTime()-d().startDate.getTime()),oe=K(()=>d().startDate.toLocaleString()+"."+d().startDate.getMilliseconds()),$e=K(()=>d().endDate.toLocaleString()+"."+d().endDate.getMilliseconds());var Ue=L(N);A(N),ae(()=>{Q(N,"title",`${H(oe)??""} - ${H($e)??""}`),se(Ue,`${H(k)??""} ms`)}),F($,N)}),A(fe),A(E),A(M),ae(()=>{Q(C,"src",d().imageSrc),se(ne,`${d().xComponents??""} âœ• ${d().yComponents??""}`),Q(j,"href",d().imageSrc),se(J,d().imageSrc),Da(G,`task-status ${d().status??""} svelte-4newrq`),se(Oe,d().status)}),_a("error",C,r),ma(C),F(l,M)};let c=ce(""),i=ce(4),w=ce(4),p=Me([]);const T=K(()=>H(c).trim()===""),S=K(()=>H(i)>0&&H(w)>0),h=K(()=>H(T)||!H(S));function x(l){const d=H(i),M=H(w),I=l.map(C=>Me({url:C,xComponents:d,yComponents:M,blurHash:"",image:new Image,imageSrc:C,blurHashImage:new Image,blurHashImageSrc:"",startDate:new Date,endDate:null,usedCorsProxy:!1,status:"in-progress",error:null}));p.unshift(...I);for(const C of I)t(C)}async function t(l){const d=new Date;l.startDate=d;const M=l.url;let I=null,C=!1;const D=new Image;D.crossOrigin="Anonymous";try{await new Promise((J,V)=>{D.onload=J,D.onerror=V,D.src=M})}catch(J){I=J}if(I!=null){I=null;const J=`https://corsproxy.io/?${encodeURIComponent(M)}`;try{await new Promise((V,G)=>{D.onload=V,D.onerror=G,D.src=J}),C=!0}catch(V){I=V}}if(I!=null){l.status="failed",l.error=I,l.endDate=new Date;return}const R=64;let P=D.width,E=D.height;P>E?P>R&&(E=Math.round(E*R/P),P=R):E>R&&(P=Math.round(P*R/E),E=R);const B=document.createElement("canvas");B.width=P,B.height=E;const U=B.getContext("2d");if(U==null){l.status="failed",l.error=new Error("Failed to get 2d context"),l.endDate=new Date,l.usedCorsProxy=C;return}U.drawImage(D,0,0,D.width,D.height,0,0,P,E);const Y=U.getImageData(0,0,P,E),X=await he.encodePromise(Y.data,Y.width,Y.height,l.xComponents,l.yComponents),ne=await he.decodePromise(X,P,E,1),Z=await he.getImageDataAsImageWithOnloadPromise(ne,P,E),j=new Date;l.endDate=j,l.blurHash=X,l.blurHashImageSrc=Z.src,l.status="completed",l.usedCorsProxy=C}function r(l){l.target.classList.add("broken-image")}async function n(l,d){try{await navigator.clipboard.writeText(d)}catch(C){console.error("Failed to copy text: ",C);return}const M=l.target;M instanceof HTMLButtonElement&&(M.classList.add("success"),M.disabled=!0,await new Promise(C=>setTimeout(C,1e3)),M.classList.remove("success"),M.disabled=!1)}var o=Ra();fa(l=>{var d=Pa();va.title="BlurHash Encoder";var M=y(be(d));F(l,d)});var v=L(o),u=y(L(v),2);Ma(u);var m=y(u,2),q=L(m);q.__click=[Ca,c,x];var b=y(q,2);ve(b);var _=y(b,2);ve(_),A(m),A(v);var g=y(v,2),f=y(L(g),2);wa(f,21,()=>p,ga,(l,d)=>{s(l,()=>H(d))}),A(f),A(g),xe(2),A(o),ae(()=>{q.disabled=H(h),Ee(b,"invalid",H(i)<=0),Ee(_,"invalid",H(w)<=0)}),de(u,()=>H(c),l=>re(c,l)),de(b,()=>H(i),l=>re(i,l)),de(_,()=>H(w),l=>re(w,l)),F(e,o),ua()}ha(["click"]);export{Fa as component};
